<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuestionario de Sostenibilidad en Moda Textil</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f8f0 0%, #e8f5e8 100%);
            color: #2d5d2d;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #1e4a1e;
            font-size: 2.5em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            color: #4a6b4a;
            font-size: 1.2em;
        }

        .form-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        fieldset {
            border: none;
            padding: 30px;
            border-bottom: 1px solid #e0f0e0;
        }

        fieldset:last-of-type {
            border-bottom: none;
        }

        legend {
            font-size: 1.4em;
            font-weight: bold;
            color: #1e4a1e;
            padding: 0 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .question {
            margin-bottom: 20px;
        }

        .question label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2d5d2d;
        }

        .question select, .question input[type="text"], .question textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #c8e6c8;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .question select:focus, .question input:focus, .question textarea:focus {
            outline: none;
            border-color: #4caf50;
        }

        .radio-group, .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .radio-option, .checkbox-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8fdf8;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .radio-option:hover, .checkbox-option:hover {
            background: #e8f5e8;
        }

        .radio-option input, .checkbox-option input {
            width: auto;
            cursor: pointer;
        }

        .radio-option label, .checkbox-option label {
            cursor: pointer;
            margin-bottom: 0;
            flex: 1;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .submit-container {
            padding: 30px;
            text-align: center;
            background: #f0f8f0;
        }

        .submit-btn {
            background: linear-gradient(45deg, #4caf50, #45a049);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .results {
            display: none;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-top: 30px;
        }

        .score-display {
            text-align: center;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .score-display.low {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            border: 2px solid #f44336;
        }

        .score-display.medium {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            border: 2px solid #ff9800;
        }

        .score-display.high {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border: 2px solid #4caf50;
        }

        .score-number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .score-category {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .chart-container {
            margin: 30px 0;
            text-align: center;
        }

        .chart-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #1e4a1e;
        }

        #scoreChart {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        #groupComparisonChart {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .open-answers {
            margin-top: 30px;
            padding: 20px;
            background: #f8fdf8;
            border-radius: 10px;
            border-left: 4px solid #4caf50;
        }

        .open-answers h3 {
            color: #1e4a1e;
            margin-bottom: 15px;
        }

        .answer-item {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .answer-question {
            font-weight: bold;
            color: #2d5d2d;
            margin-bottom: 5px;
        }

        .answer-text {
            color: #4a6b4a;
            font-style: italic;
        }

        .error-message {
            color: #d32f2f;
            font-size: 0.9em;
            margin-top: 5px;
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
                flex-direction: column;
                gap: 10px;
            }

            fieldset {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå± Cuestionario de Sostenibilidad en Moda Textil</h1>
            <p>Descubre qu√© tan sostenible es tu consumo de moda y recibe recomendaciones personalizadas</p>
        </div>

        <div class="form-container">
            <form id="sustainabilityForm">
                <fieldset>
                    <legend>üßæ Datos Demogr√°ficos</legend>
                    
                    <div class="question">
                        <label for="age">Edad:</label>
                        <select id="age" name="age" required>
                            <option value="">Selecciona tu edad</option>
                            <option value="15-24">15-24 a√±os</option>
                            <option value="25-34">25-34 a√±os</option>
                            <option value="35-44">35-44 a√±os</option>
                            <option value="45-60">45-60 a√±os</option>
                            <option value="60+">60+ a√±os</option>
                        </select>
                        <div class="error-message">Por favor, selecciona tu rango de edad</div>
                    </div>

                    <div class="question">
                        <label>G√©nero:</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="gender-male" name="gender" value="male" required>
                                <label for="gender-male">Hombre</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="gender-female" name="gender" value="female" required>
                                <label for="gender-female">Mujer</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="gender-other" name="gender" value="other" required>
                                <label for="gender-other">Otro</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="gender-no-answer" name="gender" value="no-answer" required>
                                <label for="gender-no-answer">Prefiero no decirlo</label>
                            </div>
                        </div>
                        <div class="error-message">Por favor, selecciona una opci√≥n</div>
                    </div>

                    <div class="question">
                        <label for="income">Ingresos mensuales:</label>
                        <select id="income" name="income" required>
                            <option value="">Selecciona tu rango de ingresos</option>
                            <option value="<1000">Menos de 1000‚Ç¨</option>
                            <option value="1000-1500">1000‚Ç¨ - 1500‚Ç¨</option>
                            <option value="1500-2000">1500‚Ç¨ - 2000‚Ç¨</option>
                            <option value=">2000">M√°s de 2000‚Ç¨</option>
                        </select>
                        <div class="error-message">Por favor, selecciona tu rango de ingresos</div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>üëö H√°bitos de Compra</legend>
                    
                    <div class="question">
                        <label>¬øCon qu√© frecuencia compras ropa?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="freq-weekly" name="frequency" value="1" required>
                                <label for="freq-weekly">Cada semana</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="freq-monthly" name="frequency" value="2" required>
                                <label for="freq-monthly">Cada mes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="freq-bimonthly" name="frequency" value="3" required>
                                <label for="freq-bimonthly">Cada 2-3 meses</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="freq-needed" name="frequency" value="5" required>
                                <label for="freq-needed">Solo cuando lo necesito</label>
                            </div>
                        </div>
                        <div class="error-message">Por favor, selecciona una opci√≥n</div>
                    </div>

                    <div class="question">
                        <label>¬øCompras moda r√°pida (Shein, Zara, H&M)?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="fast-frequent" name="fastFashion" value="1" required>
                                <label for="fast-frequent">S√≠, frecuentemente</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="fast-sometimes" name="fastFashion" value="2" required>
                                <label for="fast-sometimes">A veces</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="fast-little" name="fastFashion" value="4" required>
                                <label for="fast-little">Muy poco</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="fast-never" name="fastFashion" value="5" required>
                                <label for="fast-never">No, nunca</label>
                            </div>
                        </div>
                        <div class="error-message">Por favor, selecciona una opci√≥n</div>
                    </div>

                    <div class="question">
                        <label>¬øLees etiquetas o materiales antes de comprar?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="labels-never" name="readLabels" value="1" required>
                                <label for="labels-never">Nunca</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="labels-sometimes" name="readLabels" value="3" required>
                                <label for="labels-sometimes">A veces</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="labels-always" name="readLabels" value="5" required>
                                <label for="labels-always">Siempre</label>
                            </div>
                        </div>
                        <div class="error-message">Por favor, selecciona una opci√≥n</div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>üå± Conciencia Ambiental</legend>
                    
                    <div class="question">
                        <label>¬øSab√≠as que la industria textil es contaminante?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="know-pollution-no" name="knowPollution" value="1" required>
                                <label for="know-pollution-no">No</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="know-pollution-yes" name="knowPollution" value="4" required>
                                <label for="know-pollution-yes">S√≠</label>
                            </div>
                        </div>
                        <div class="error-message">Por favor, selecciona una opci√≥n</div>
                    </div>

                    <div class="question">
                        <label>¬øConoces materiales sostenibles?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="know-materials-no" name="knowMaterials" value="1" required>
                                <label for="know-materials-no">No</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="know-materials-yes" name="knowMaterials" value="4" required>
                                <label for="know-materials-yes">S√≠</label>
                            </div>
                        </div>
                        <div class="error-message">Por favor, selecciona una opci√≥n</div>
                    </div>

                    <div class="question">
                        <label>¬øConoces certificaciones ecol√≥gicas?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="know-certs-no" name="knowCertifications" value="1" required>
                                <label for="know-certs-no">No</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="know-certs-yes" name="knowCertifications" value="5" required>
                                <label for="know-certs-yes">S√≠</label>
                            </div>
                        </div>
                        <div class="error-message">Por favor, selecciona una opci√≥n</div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>üîÑ Comportamientos Sostenibles</legend>
                    
                    <div class="question">
                        <label>¬øHas comprado ropa de segunda mano?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="secondhand-no" name="secondHand" value="1" required>
                                <label for="secondhand-no">No</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="secondhand-sometimes" name="secondHand" value="3" required>
                                <label for="secondhand-sometimes">Una o dos veces</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="secondhand-yes" name="secondHand" value="5" required>
                                <label for="secondhand-yes">S√≠, regularmente</label>
                            </div>
                        </div>
                        <div class="error-message">Por favor, selecciona una opci√≥n</div>
                    </div>

                    <div class="question">
                        <label>¬øQu√© haces con tu ropa cuando no la usas? (Puedes seleccionar varias opciones)</label>
                        <div class="checkbox-group">
                            <div class="checkbox-option">
                                <input type="checkbox" id="dispose-trash" name="disposal" value="0">
                                <label for="dispose-trash">La tiro</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="dispose-donate" name="disposal" value="4">
                                <label for="dispose-donate">La dono</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="dispose-sell" name="disposal" value="4">
                                <label for="dispose-sell">La vendo/intercambio</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="dispose-recycle" name="disposal" value="5">
                                <label for="dispose-recycle">La reciclo</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="dispose-reuse" name="disposal" value="5">
                                <label for="dispose-reuse">La reutilizo</label>
                            </div>
                        </div>
                        <div class="error-message">Por favor, selecciona al menos una opci√≥n</div>
                    </div>

                    <div class="question">
                        <label>¬øPagar√≠as m√°s por ropa sostenible?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="pay-no" name="payMore" value="1" required>
                                <label for="pay-no">No</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="pay-depends" name="payMore" value="3" required>
                                <label for="pay-depends">Depende</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="pay-yes" name="payMore" value="5" required>
                                <label for="pay-yes">S√≠</label>
                            </div>
                        </div>
                        <div class="error-message">Por favor, selecciona una opci√≥n</div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>üí¨ Reflexiones Personales</legend>
                    
                    <div class="question">
                        <label for="promote-sustainable">¬øQu√© har√≠as t√∫ para fomentar un consumo textil m√°s responsable?</label>
                        <textarea id="promote-sustainable" name="promoteSustainable" placeholder="Comparte tus ideas sobre c√≥mo promover la moda sostenible..."></textarea>
                    </div>

                    <div class="question">
                        <label for="past-advice">¬øQu√© mensaje le dar√≠as a tu 'yo del pasado' sobre c√≥mo consumir ropa?</label>
                        <textarea id="past-advice" name="pastAdvice" placeholder="¬øQu√© consejo le dar√≠as a tu versi√≥n anterior sobre el consumo de moda?"></textarea>
                    </div>
                </fieldset>

                <div class="submit-container">
                    <button type="button" class="submit-btn" id="submitButton">üåü Calcular mi Puntuaci√≥n de Sostenibilidad</button>
                </div>
            </form>
        </div>

        <div id="results" class="results">
            <div id="scoreDisplay" class="score-display">
                <div id="scoreNumber" class="score-number"></div>
                <div id="scoreCategory" class="score-category"></div>
                <div id="scoreDescription"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">üìä Comparaci√≥n con la Media General</div>
                <canvas id="scoreChart" width="600" height="200"></canvas>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">üìã Comparativa por Grupos</div>
                <canvas id="groupComparisonChart" width="600" height="350"></canvas>
            </div>

            <div id="openAnswers" class="open-answers">
                <h3>üí≠ Tus Reflexiones</h3>
                <div id="answersContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Hacer que toda la opci√≥n sea clickeable
        document.addEventListener('DOMContentLoaded', function() {
            const radioOptions = document.querySelectorAll('.radio-option');
            const checkboxOptions = document.querySelectorAll('.checkbox-option');
            
            radioOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'LABEL') {
                        const input = this.querySelector('input[type="radio"]');
                        if (input) {
                            input.checked = true;
                        }
                    }
                });
            });
            
            checkboxOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'LABEL') {
                        const input = this.querySelector('input[type="checkbox"]');
                        if (input) {
                            input.checked = !input.checked;
                        }
                    }
                });
            });

            document.getElementById('submitButton').addEventListener('click', function(e) {
                e.preventDefault();
                if (validateForm()) {
                    calculateAndShowResults();
                }
            });
        });

        function validateForm() {
            let isValid = true;
            const form = document.getElementById('sustainabilityForm');
            
            // Validar campos requeridos
            const requiredSelects = form.querySelectorAll('select[required]');
            requiredSelects.forEach(select => {
                const errorMsg = select.parentNode.querySelector('.error-message');
                if (!select.value) {
                    errorMsg.style.display = 'block';
                    isValid = false;
                } else {
                    errorMsg.style.display = 'none';
                }
            });

            // Validar radio buttons
            const radioGroups = ['gender', 'frequency', 'fastFashion', 'readLabels', 'knowPollution', 'knowMaterials', 'knowCertifications', 'secondHand', 'payMore'];
            radioGroups.forEach(groupName => {
                const group = form.querySelectorAll(`input[name="${groupName}"]`);
                const checked = form.querySelector(`input[name="${groupName}"]:checked`);
                const errorMsg = group[0].closest('.question').querySelector('.error-message');
                
                if (!checked) {
                    errorMsg.style.display = 'block';
                    isValid = false;
                } else {
                    errorMsg.style.display = 'none';
                }
            });

            // Validar checkboxes (al menos uno debe estar seleccionado)
            const disposalCheckboxes = form.querySelectorAll('input[name="disposal"]:checked');
            const disposalErrorMsg = form.querySelector('input[name="disposal"]').closest('.question').querySelector('.error-message');
            if (disposalCheckboxes.length === 0) {
                disposalErrorMsg.style.display = 'block';
                isValid = false;
            } else {
                disposalErrorMsg.style.display = 'none';
            }

            return isValid;
        }

        function calculateAndShowResults() {
            const form = document.getElementById('sustainabilityForm');
            const formData = new FormData(form);
            
            let totalScore = 0;

            // Calcular puntuaci√≥n de campos num√©ricos
            const numericFields = ['frequency', 'fastFashion', 'readLabels', 'knowPollution', 'knowMaterials', 'knowCertifications', 'secondHand', 'payMore'];
            numericFields.forEach(field => {
                const value = formData.get(field);
                if (value) {
                    totalScore += parseInt(value);
                }
            });

            // Calcular puntuaci√≥n de checkboxes (disposal)
            const disposalValues = formData.getAll('disposal');
            disposalValues.forEach(value => {
                totalScore += parseInt(value);
            });

            // Determinar categor√≠a
            let category, categoryClass, emoji, description;
            if (totalScore <= 20) {
                category = 'Poco sostenible';
                categoryClass = 'low';
                emoji = 'üî¥';
                description = 'Tu consumo de moda tiene un impacto ambiental alto. ¬°Pero nunca es tarde para empezar a cambiar!';
            } else if (totalScore <= 30) {
                category = 'Moderadamente sostenible';
                categoryClass = 'medium';
                emoji = 'üü°';
                description = 'Vas por buen camino, pero hay margen de mejora para ser m√°s sostenible.';
            } else {
                category = 'Muy sostenible';
                categoryClass = 'high';
                emoji = 'üü¢';
                description = '¬°Excelente! Tu consumo de moda es muy consciente con el medio ambiente.';
            }

            // Mostrar resultados
            const scoreDisplay = document.getElementById('scoreDisplay');
            scoreDisplay.className = `score-display ${categoryClass}`;
            document.getElementById('scoreNumber').textContent = totalScore;
            document.getElementById('scoreCategory').textContent = `${emoji} ${category}`;
            document.getElementById('scoreDescription').textContent = description;

            // Mostrar respuestas abiertas
            const answersContent = document.getElementById('answersContent');
            const promoteSustainable = formData.get('promoteSustainable');
            const pastAdvice = formData.get('pastAdvice');
            
            answersContent.innerHTML = '';
            
            if (promoteSustainable && promoteSustainable.trim()) {
                const answerDiv = document.createElement('div');
                answerDiv.className = 'answer-item';
                answerDiv.innerHTML = `
                    <div class="answer-question">¬øQu√© har√≠as para fomentar un consumo textil m√°s responsable?</div>
                    <div class="answer-text">"${promoteSustainable}"</div>
                `;
                answersContent.appendChild(answerDiv);
            }

            if (pastAdvice && pastAdvice.trim()) {
                const answerDiv = document.createElement('div');
                answerDiv.className = 'answer-item';
                answerDiv.innerHTML = `
                    <div class="answer-question">¬øQu√© mensaje le dar√≠as a tu 'yo del pasado'?</div>
                    <div class="answer-text">"${pastAdvice}"</div>
                `;
                answersContent.appendChild(answerDiv);
            }

            if (!promoteSustainable.trim() && !pastAdvice.trim()) {
                answersContent.innerHTML = '<p style="color: #666; font-style: italic;">No has proporcionado respuestas a las preguntas abiertas.</p>';
            }

            // Crear gr√°fico de comparaci√≥n general
            createChart(totalScore);

            // Crear gr√°fico de comparaci√≥n por grupos
            createGroupComparisonChart(totalScore, formData);

            // Mostrar secci√≥n de resultados
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        function createChart(userScore) {
            const canvas = document.getElementById('scoreChart');
            const ctx = canvas.getContext('2d');
            
            // Limpiar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const averageScore = 29; // Media general simulada
            const maxScore = 45;
            
            // Configuraci√≥n del gr√°fico
            const barHeight = 40;
            const barSpacing = 60;
            const maxBarWidth = canvas.width - 200; // Adjust max bar width for wider canvas
            const startX = 120; // Adjust starting X to make space for labels
            const startY = 30;
            
            // Calcular anchuras de barras
            const userBarWidth = (userScore / maxScore) * maxBarWidth;
            const averageBarWidth = (averageScore / maxScore) * maxBarWidth;
            
            // Colores
            const userColor = userScore > averageScore ? '#4CAF50' : '#FF9800';
            const averageColor = '#9E9E9E';
            
            // Dibujar barra del usuario
            ctx.fillStyle = userColor;
            ctx.fillRect(startX, startY, userBarWidth, barHeight);
            
            // Dibujar barra de la media
            ctx.fillStyle = averageColor;
            ctx.fillRect(startX, startY + barSpacing, averageBarWidth, barHeight);
            
            // Configurar texto
            ctx.fillStyle = '#333';
            ctx.font = 'bold 14px Arial';
            
            // Etiquetas
            ctx.textAlign = 'right';
            ctx.fillText('Tu puntuaci√≥n', startX - 10, startY + 25);
            ctx.fillText('Media general', startX - 10, startY + barSpacing + 25);
            
            // Valores num√©ricos
            ctx.textAlign = 'left';
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Arial';
            ctx.fillText(userScore + ' pts', startX + userBarWidth + 10, startY + 25);
            ctx.fillText(averageScore + ' pts', startX + averageBarWidth + 10, startY + barSpacing + 25);
            
            // T√≠tulo del eje
            ctx.textAlign = 'center';
            ctx.font = '12px Arial';
            ctx.fillStyle = '#666';
            ctx.fillText('0', startX, startY + barSpacing + 60);
            ctx.fillText(maxScore, startX + maxBarWidth, startY + barSpacing + 60);
        }

        function createGroupComparisonChart(userScore, formData) {
            const canvas = document.getElementById('groupComparisonChart');
            const ctx = canvas.getContext('2d');
            
            // Limpiar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const maxScore = 45;
            const barHeight = 25;
            const barSpacing = 40;
            const labelX = 10;
            const chartStartX = 180; // Adjusted for longer labels
            const chartWidth = canvas.width - chartStartX - 50; // Remaining width for bars
            const scoreLabelOffset = 10;

            const groupData = [
                { label: 'Edad 15-24', average: 28, groupType: 'age', groupValue: '15-24' },
                { label: 'Edad 25-34', average: 30, groupType: 'age', groupValue: '25-34' },
                { label: 'Edad 35-44', average: 32, groupType: 'age', groupValue: '35-44' },
                { label: 'Edad 45-60', average: 31, groupType: 'age', groupValue: '45-60' }, // Added
                { label: 'Edad 60+', average: 34, groupType: 'age', groupValue: '60+' },     // Added
                { label: 'Hombre', average: 27, groupType: 'gender', groupValue: 'male' },
                { label: 'Mujer', average: 31, groupType: 'gender', groupValue: 'female' },
                { label: 'Otro G√©nero', average: 29, groupType: 'gender', groupValue: 'other' }, // Added
                { label: 'Prefiero no decirlo', average: 30, groupType: 'gender', groupValue: 'no-answer' }, // Added
                { label: 'Ingresos < 1000‚Ç¨', average: 26, groupType: 'income', groupValue: '<1000' },
                { label: 'Ingresos 1000-1500‚Ç¨', average: 29, groupType: 'income', groupValue: '1000-1500' }, // Added
                { label: 'Ingresos 1500-2000‚Ç¨', average: 31, groupType: 'income', groupValue: '1500-2000' }, // Added
                { label: 'Ingresos > 2000‚Ç¨', average: 33, groupType: 'income', groupValue: '>2000' }
            ];

            const userAge = formData.get('age');
            const userGender = formData.get('gender');
            const userIncome = formData.get('income');

            ctx.textBaseline = 'middle';

            groupData.forEach((group, index) => {
                const y = 30 + index * barSpacing;

                // Determine if this group applies to the user
                const appliesToUser = 
                    (group.groupType === 'age' && group.groupValue === userAge) ||
                    (group.groupType === 'gender' && group.groupValue === userGender) ||
                    (group.groupType === 'income' && group.groupValue === userIncome);

                // Draw group label
                ctx.fillStyle = '#2d5d2d';
                ctx.textAlign = 'left';
                
                // Bold and underline if it applies to the user
                if (appliesToUser) {
                    ctx.font = 'bold 14px Arial'; // Set bold font
                    ctx.fillText(group.label, labelX, y + barHeight / 2);
                    // Draw underline
                    const textWidth = ctx.measureText(group.label).width;
                    ctx.beginPath();
                    ctx.strokeStyle = '#2d5d2d';
                    ctx.lineWidth = 1;
                    ctx.moveTo(labelX, y + barHeight / 2 + 8); // Position the underline slightly below text
                    ctx.lineTo(labelX + textWidth, y + barHeight / 2 + 8);
                    ctx.stroke();
                } else {
                    ctx.font = '14px Arial'; // Regular font
                    ctx.fillText(group.label, labelX, y + barHeight / 2);
                }

                // Draw average bar
                const averageBarLength = (group.average / maxScore) * chartWidth;
                ctx.fillStyle = '#B0C4DE'; // Light blue for average
                ctx.fillRect(chartStartX, y, averageBarLength, barHeight);

                // Draw user score bar
                const userBarLength = (userScore / maxScore) * chartWidth;
                let userBarColor;
                if (userScore > group.average) {
                    userBarColor = '#4CAF50'; // Green if user is higher
                } else if (userScore < group.average) {
                    userBarColor = '#F44336'; // Red if user is lower
                } else {
                    userBarColor = '#FFC107'; // Amber if equal
                }
                ctx.fillStyle = userBarColor;
                ctx.fillRect(chartStartX, y + barHeight / 2 - 5, userBarLength, 10); // Thinner bar for user score, centered

                // Draw average score text
                ctx.fillStyle = '#333';
                ctx.textAlign = 'left';
                ctx.font = '12px Arial';
                ctx.fillText(`${group.average} pts`, chartStartX + averageBarLength + scoreLabelOffset, y + barHeight / 2);

            });

            // Draw axis at the bottom
            ctx.fillStyle = '#666';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('0', chartStartX, canvas.height - 10);
            ctx.textAlign = 'right';
            ctx.fillText(maxScore, chartStartX + chartWidth, canvas.height - 10);
            ctx.strokeStyle = '#ccc';
            ctx.beginPath();
            ctx.moveTo(chartStartX, canvas.height - 20);
            ctx.lineTo(chartStartX + chartWidth, canvas.height - 20);
            ctx.stroke();
        }
    </script>
</body>
</html>
